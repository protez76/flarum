module.exports=function(t){var o={};function e(n){if(o[n])return o[n].exports;var a=o[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}return e.m=t,e.c=o,e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,o){if(1&o&&(t=e(t)),8&o)return t;if(4&o&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var a in t)e.d(n,a,function(o){return t[o]}.bind(null,a));return n},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},e.p="",e(e.s=19)}([function(t,o){t.exports=flarum.core.compat.app},function(t,o){t.exports=flarum.core.compat.Model},function(t,o){t.exports=flarum.core.compat.extend},function(t,o){t.exports=flarum.core.compat["components/DiscussionComposer"]},function(t,o){t.exports=flarum.core.compat["components/Button"]},function(t,o){t.exports=flarum.core.compat["models/User"]},function(t,o){t.exports=flarum.core.compat["utils/mixin"]},function(t,o){t.exports=flarum.core.compat["components/Page"]},function(t,o){t.exports=flarum.core.compat.Component},function(t,o){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,o){t.exports=flarum.core.compat["helpers/avatar"]},function(t,o){t.exports=flarum.core.compat["helpers/icon"]},function(t,o){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,o){t.exports=flarum.core.compat["utils/string"]},function(t,o){t.exports=flarum.core.compat["components/HeaderSecondary"]},function(t,o){t.exports=flarum.core.compat["components/NotificationsDropdown"]},function(t,o){t.exports=flarum.core.compat["components/Composer"]},function(t,o){t.exports=flarum.core.compat["components/Alert"]},,function(t,o,e){"use strict";e.r(o);var n=e(2),a=e(5),r=e.n(a),i=e(1),s=e.n(i);function c(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,t.__proto__=o}var p=e(6),f=function(t){function o(){return t.apply(this,arguments)||this}return c(o,t),o}(e.n(p)()(s.a,{user:s.a.hasOne("user"),content:s.a.attribute("content"),title:s.a.attribute("title"),relationships:s.a.attribute("relationships"),updatedAt:s.a.attribute("updatedAt",s.a.transformDate)})),u=e(7),d=e.n(u),l=e(8),h=e.n(l),y=e(9),v=e.n(y),b=e(3),x=e.n(b),g=e(10),N=e.n(g),w=e(11),O=e.n(w),j=e(12),C=e.n(j),_=e(13),A=e(4),D=e.n(A),P=function(t){function o(){return t.apply(this,arguments)||this}c(o,t);var e=o.prototype;return e.init=function(){this.loading=!1},e.config=function(t){t&&$(".draft--delete").on("click tap",(function(t){t.stopPropagation()}))},e.view=function(){var t=this,o=app.cache.drafts||[];return m("div",{className:"NotificationList DraftsList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},app.translator.trans("fof-drafts.forum.dropdown.title"))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},o.length?o.sort((function(t,o){return o.updatedAt()-t.updatedAt()})).map((function(o){return m("li",null,m("a",{onclick:t.showComposer.bind(t,o),className:"Notification draft--item"},N()(o.user()),O()("fas fa-edit",{className:"Notification-icon"}),m("span",{className:"Notification-content"},o.title()),C()(o.updatedAt()),D.a.component({icon:"fas fa-times",style:"float: right; z-index: 20;",className:"Button Button--icon Button--link draft--delete",title:app.translator.trans("fof-drafts.forum.dropdown.button"),onclick:t.deleteDraft.bind(t,o)}),m("div",{className:"Notification-excerpt"},Object(_.truncate)(o.content(),200))))})):this.loading?v.a.component({className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},app.translator.trans("fof-drafts.forum.dropdown.empty_text")))))},e.deleteDraft=function(t){this.loading=!0,window.confirm(app.translator.trans("fof-drafts.forum.dropdown.alert"))&&(t.delete(),app.cache.drafts.some((function(o,e){o.id()===t.id()&&app.cache.drafts.splice(e,1)})),app.composer.hide(),this.loading=!1)},e.showComposer=function(t){if(!this.loading){var o=m.deferred(),e={originalContent:t.content(),title:t.title(),user:app.session.user,confirmExit:app.translator.trans("fof-drafts.forum.composer.exit_alert"),draft:t},n=t.relationships();n&&Object.keys(n).forEach((function(t){var o=n[t].data.map((function(t,o){return app.store.getById(t.type,t.id)}));e[t]=o}));var a=new x.a(e);return app.composer.load(a),app.composer.show(),o.resolve(a),o.promise}},e.load=function(){var t=this;app.cache.drafts||(this.loading=!0,m.redraw(),app.store.find("drafts").then((function(t){delete t.payload,app.cache.drafts=t})).catch((function(){})).then((function(){t.loading=!1,m.redraw()})))},o}(h.a),k=function(t){function o(){return t.apply(this,arguments)||this}c(o,t);var e=o.prototype;return e.init=function(){t.prototype.init.call(this),app.history.push("drafts"),this.list=new P,this.list.load(),this.bodyClass="App--drafts"},e.view=function(){return m("div",{className:"DraftsPage"},this.list.render())},o}(d.a),B=e(0),S=e.n(B),L=e(14),M=e.n(L),E=e(15),I=function(t){function o(){return t.apply(this,arguments)||this}c(o,t),o.initProps=function(o){o.label=o.label||app.translator.trans("fof-drafts.forum.dropdown.tooltip"),o.icon=o.icon||"fas fa-edit",t.initProps.call(this,o)};var e=o.prototype;return e.init=function(){t.prototype.init.call(this),this.list=new P},e.goToRoute=function(){m.route(app.route("drafts"))},e.getUnreadCount=function(){return app.cache.drafts?app.cache.drafts.length:app.session.user.drafts().length},e.getNewCount=function(){return app.cache.drafts?app.cache.drafts.length:app.session.user.drafts().length},o}(e.n(E).a),T=e(16),z=e.n(T),R=e(17),U=e.n(R);app.initializers.add("fof-drafts",(function(){app.store.models.drafts=f,r.a.prototype.drafts=s.a.hasMany("drafts"),app.routes.drafts={path:"/drafts",component:m(k,null)},Object(n.extend)(z.a.prototype,"controlItems",(function(t){var o=this;this.component instanceof x.a&&app.forum.attribute("canSaveDrafts")&&t.add("save-draft",D.a.component({icon:"fas fa-save",className:"Button Button--icon Button--link",title:app.translator.trans("fof-drafts.forum.composer.title"),onclick:function(){o.component.draft?(delete o.component.draft.data.attributes.relationships,o.component.draft.save(o.component.data()).then((function(t){app.cache.drafts=app.cache.drafts||[],app.cache.drafts.forEach((function(o,e){if(o.id()===t.id()){var n=new Date;t.data.attributes.updatedAt=n.toString(),app.cache.drafts[e]=t}}))}))):app.store.createRecord("drafts").save(o.component.data()).then((function(t){app.cache.drafts?app.cache.drafts.push(t):app.session.user.data.relationships.drafts.data.push(t),m.redraw()})),app.alerts.show(o.successAlert=new U.a({type:"success",children:app.translator.trans("fof-drafts.forum.composer.alert")})),app.composer.hide()}}),20)})),Object(n.extend)(x.a.prototype,"init",(function(){var t=this;Object.keys(this.props).forEach((function(o){["originalContent","title","user"].includes(o)?"title"===o&&(t.title=m.prop(t.props.title)):t[o]=t.props[o]}))})),Object(n.extend)(x.a.prototype,"onsubmit",(function(){var t=this;this.draft&&(this.draft.delete(),app.cache.drafts=app.cache.drafts.filter((function(o){return o.id()!==t.draft.id()})))})),Object(n.extend)(M.a.prototype,"items",(function(t){S.a.session.user&&(S.a.session.user.drafts()&&S.a.session.user.drafts().length&&!S.a.cache.drafts||S.a.cache.drafts&&0!==S.a.cache.drafts.length)&&t.add("Drafts",m(I,null),20)}))}))}]);
//# sourceMappingURL=forum.js.map